---
title: "Virtual Inference of Protein-activity by Enriched Regulon analysis (preparing input)"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    theme: cosmo
    highlight: textmate
editor_options:
  chunk_output_type: console
---

# Load packages
```{r message=FALSE, warning=FALSE}
library(viper)
```

# Generating the regulon object
```{r eval=FALSE, include=TRUE}
set.seed(0)
for (ca in c("kirc", "hnsc", "lusc", "luad", "paad")) {
    adjfile <- paste("/Users/zhenzuo/PRO/PPP/output/viper/regulon/regulon", ca, "_SYMBOL.adj",
        sep = "")
    expr_normal <- readRDS(paste("output/viper/exprs/", ca, "_normal.RDS",
        sep = ""))
    expr_tumor <- readRDS(paste("output/viper/exprs/", ca, "_tumor.RDS",
        sep = ""))
    expr <- merge(expr_normal, expr_tumor, by = "row.names", all = FALSE)
    rownames(expr) <- expr$Row.names
    expr$Row.names <- NULL

    expr <- expr[rowSums(expr) > 0, ]
    pattern <- "[^A-Za-z0-9 ]"

    expr <- expr[!grepl(pattern, rownames(expr)), ]
    expr <- expr[apply(expr, 1, var) >= 0.3, ]
    signature <- c(rep("normal", dim(expr_normal)[2]), rep("tumor", dim(expr_tumor)[2]))
    dset <- ExpressionSet(assayData = as.matrix(expr))
    dset$description <- signature
    regul <- aracne2regulon(adjfile, dset, verbose = FALSE)
    saveRDS(dset, paste("output/viper/expr_processed/", ca, ".RDS", sep = ""))
    saveRDS(regul, paste("output/viper/regul_object/", ca, ".RDS", sep = ""))
}
```